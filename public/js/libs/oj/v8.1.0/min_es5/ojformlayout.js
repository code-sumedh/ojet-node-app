/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * @ignore
 */
define(["ojs/ojcore","ojs/ojcontext","ojs/ojcomponentcore","ojs/ojlabel","ojs/ojlogger","ojs/ojthemeutils"],function(e,t,l,a,n,o){"use strict";var i={properties:{colspanWrap:{type:"string",enumValues:["nowrap","wrap"]},direction:{type:"string",enumValues:["column","row"],value:"column"},labelEdge:{type:"string",enumValues:["inside","start","top"]},labelWidth:{type:"string",value:"33%"},labelWrapping:{type:"string",enumValues:["truncate","wrap"],value:"wrap"},maxColumns:{type:"number",value:1}},methods:{setProperty:{},getProperty:{},setProperties:{},refresh:{},getNodeBySubId:{},getSubIdByNode:{}},extension:{}};Object.freeze(i);var r=0;function s(l){var a,i,s,d,u,c,f=this,m=l.element,p="-labelled-by",h="data-oj-formlayout-bonus-dom",b="["+h+"]",v=!0,y=!1;function g(){i&&(i(),i=null)}function x(){a&&(a(),a=null)}function j(e){return"inside"===m.labelEdge||"inside"===e.labelEdge||"none"===e.labelEdge}function C(e){var t=null;return j(e)?t:(e instanceof Element&&"labelHint"in e&&""!==e.labelHint&&(H(e),t=function(e){var t=e.labelledBy;if(t){var l=document.getElementById(t);l&&n.error("The oj-form-layout descendent component with id "+e.id+' has both label-hint and labelled-by. Remove labelled-by="'+t+'" since no matching element was found in the document, and a label will be created using the label-hint.')}var a=document.createElement("oj-label");a.setAttribute(h,""),a.setAttribute("data-oj-internal",""),a.setAttribute("data-oj-binding-provider","none"),a.setAttribute("data-oj-context","");var o=document.createElement("span");return o.id=e.id+"|hint",o.textContent=e.labelHint,function(e,t){var l=t,a=e.helpHints;a&&(a.definition||a.source)&&(l.help=a),l.showRequired=e.required}(e,a),a.appendChild(o),function(e,t){var l=e,a=t;l.id=a.id+p,l.setAttribute("for",a.id)}(a,e),a}(e),e.parentElement.insertBefore(t,e),function(e){e.addEventListener("labelHintChanged",E),e.addEventListener("helpHintsChanged",L),e.addEventListener("requiredChanged",w)}(e)),t)}function E(e){var t=e.target,l=document.getElementById(t.id+"|hint");l&&(l.innerText=e.detail.value)}function L(e){var t=O(e.target);t&&(t.help=e.detail.value)}function w(e){var t=O(e.target);t&&(t.showRequired=e.detail.value)}function O(e){return"labelledBy"in e?document.getElementById(e.labelledBy):m.querySelector('oj-label[for="'+e.id+'"]')}function A(e,t){var l=1;return"column"===m.direction?"100%":(e&&"colspan"in e&&e.colspan&&(l=Math.min(Math.floor(e.colspan),t)),Math.floor(1e5/m.maxColumns)/1e3*l+"%")}function B(){if(!c&&(c=u,"start"===m.labelEdge&&"row"===m.direction)){var e=m.labelWidth.match(/^([+-]?(?:\d+|\d*\.\d+))([a-z]*|%)$/);switch(e[2]){case"vw":case"vmin":case"vmax":case"%":c=e[1]/m.maxColumns+e[2]}}return c}function N(e,t){var l=M("oj-flex-item");return l.style.flexGrow="0",l.style.flexShrink="1",l.style.flexBasis=t,l.style.maxWidth=t,l.style.width=t,e.appendChild(l),l}function W(e,t){var l=m.maxColumns,a=t%l,n=A();if("column"!==m.direction&&e&&a>0)for(var o=a;o<l;o++)N(e,n)}function S(e,t,l,a){var n,o;n=l?M("oj-flex"):e.previousElementSibling;var i=t?B():A(e,a);t||(o=N(n,"0px"));var r=M("oj-flex-item");if(n.appendChild(r),e.parentElement.insertBefore(n,e),r.appendChild(e),t){r.style.flexGrow="0",r.style.flexShrink="0",r.style.flexBasis=i,r.style.maxWidth=i,r.style.width=i;var s=M("oj-flex-item");n.appendChild(s),"row"===m.direction&&"top"===m.labelEdge&&(s.appendChild(e),r.style.flex="0 1 0px",r.style.maxWidth="0px",r.style.width="0px",r.classList.add("oj-formlayout-label-comp-flex-item"),s.classList.add("oj-formlayout-label-comp-flex-item")),i=function(e,t){return"start"===m.labelEdge?"calc("+A(e,t)+" - "+B()+")":A(e,t)}(e,a),s.appendChild(t),s.style.flexGrow="1",s.style.flexShrink="1",s.style.flexBasis=i,s.style.maxWidth=i,s.style.width=i,"OJ-FORM-LAYOUT"===t.tagName&&s.classList.add("oj-formlayout-nested-formlayout")}else"labelHint"in e&&j(e)?("row"===m.direction&&(o.style.flex="0 1 0px",o.style.maxWidth="0px",o.style.width="0px",o.classList.add("oj-formlayout-label-comp-flex-item"),r.classList.add("oj-formlayout-label-comp-flex-item")),r.style.flex="1 1 0",r.style.maxWidth=i,r.style.width=i):(i=A(e,a),r.style.flexGrow="1",r.style.flexShrink="1",r.style.flexBasis=i,r.style.maxWidth=i,r.style.width=i,o.classList.add("oj-formlayout-no-label-flex-item"),r.classList.add("oj-formlayout-no-label-flex-item"),"OJ-LABEL-VALUE"===e.tagName?(o.classList.add("oj-formlayout-nested-labelvalue"),r.classList.add("oj-formlayout-nested-labelvalue"),e.setAttribute("data-oj-colspan",a),e.refresh()):"OJ-FORM-LAYOUT"===e.tagName&&r.classList.add("oj-formlayout-nested-formlayout"));return n}function M(e){var t=document.createElement("div");return t.setAttribute(h,""),t.setAttribute("data-oj-internal",""),t.classList.add(e),t}function R(e){for(var t=e,l=!0;t!==m;){if("OJ-FORM-LAYOUT"===t.tagName){l=!1;break}if(null==(t=t.parentElement)){l=!1;break}}return l}function T(e){for(;e.firstElementChild;){var t=e.firstElementChild;e.parentNode.insertBefore(t,e);t.refresh&&t.classList.contains("oj-complete")&&t.refresh()}e.parentNode.removeChild(e)}function H(e){var t=e;t.id||(t.id="oflId_"+r,r+=1)}function k(e){var t=o.parseJSONFromFontFamily("oj-form-layout-option-defaults")||{};e?(e.props.labelEdge||(m.labelEdge=t.labelEdge),e.props.colspanWrap||(m.colspanWrap=t.colspanWrap)):(m.labelEdge||(m.labelEdge=t.labelEdge),m.colspanWrap||(m.colspanWrap=t.colspanWrap))}k(l),f._rootElementMutationObserver=new MutationObserver(function(e){document.body.contains(m)?(!function(e){for(var t=e.length,l=0;l<t;l++){var a=e[l];if("childList"===a.type)for(var n=a.addedNodes.length,o=0;o<n;o++){var i=a.addedNodes[o];i.parentNode===m&&s.appendChild(i)}}}(e),function(e){for(var t=!0,l=e.length,a=["colspan","label-hint"],n=0;n<l;n++){var o=e[n];if("childList"===o.type&&((i=o.target)===m||i&&"DIV"===i.tagName&&i.hasAttribute(h))&&R(o.target)){t=!1;break}if("attributes"===o.type&&a.includes(o.attributeName)){t=!1;break}}var i;return t}(e)||(!function(e){for(var t=e.length,l=0;l<t;l++){var a=e[l];if("childList"===a.type)for(var n=a.removedNodes.length,o=0;o<n;o++){var i=a.removedNodes[o];1===i.nodeType&&(i.removeEventListener("labelHintChanged",E),i.removeEventListener("helpHintsChanged",L),i.removeEventListener("requiredChanged",w))}}}(e),m.refresh())):this.disconnect()}),this.createDOM=function(){for(m.classList.add("oj-form-layout"),(s=document.createElement("div")).classList.add("oj-form"),s.setAttribute("data-oj-context",""),s.setAttribute("data-oj-internal",""),s.setAttribute(h,"");m.firstChild;)s.appendChild(m.firstChild);m.appendChild(s)},this.updateDOM=function(){function l(){!function(){if(!i){var e=t.getContext(m).getBusyContext(),l={description:"The oj-form-layout component with id = '"+m.id+"' is being rendered."};i=e.addBusyState(l)}}(),k(),d=[],c=null,u="start"===m.labelEdge?m.labelWidth:"100%",t.getContext(s).getBusyContext().whenReady().then(function(){var l=document.activeElement,o=!1;!function(){if(!a){var e=t.getContext(s).getBusyContext(),l={description:"The oj-form div for oj-form-layout component with id = '"+m.id+"' is being rendered."};a=e.addBusyState(l)}}(),f._rootElementMutationObserver.disconnect(),function(){var e=m.maxColumns;if("start"===m.labelEdge){var t=parseInt(m.labelWidth,10);(isNaN(t)||t>0)&&s.classList.add("oj-form-cols-labels-inline"),s.classList.add("oj-formlayout-labels-inline"),s.classList.remove("oj-form-cols")}else s.classList.add("oj-form-cols"),s.classList.remove("oj-form-cols-labels-inline"),s.classList.remove("oj-formlayout-labels-inline");"truncate"===m.labelWrapping?s.classList.add("oj-formlayout-labels-nowrap"):s.classList.remove("oj-formlayout-labels-nowrap");"row"===m.direction?(e=1,s.classList.add("oj-formlayout-form-across")):(e=m.maxColumns,s.classList.remove("oj-formlayout-form-across"));s.style.columnCount=e,s.style.webkitColumnCount=e,s.style.MozColumnCount=e}(),v||function(){for(var e=s.querySelectorAll(b),t=e.length,l=0;l<t;++l){var a=e[l];R(a)&&("OJ-LABEL"===a.tagName?(a.for="",a.parentElement.removeChild(a)):T(a))}}(),function(){var e=s.firstElementChild,t=0,l="column"===m.direction;for(;e;){var a=e.tagName.toLowerCase();if(-1!==a.indexOf("-"))if("oj-label"===a){var n=e;if(!(e=e.nextElementSibling))throw H(m),H(n),x(),g(),new Error("oj-form-layout component with id='"+m.id+"' has an oj-label child element with id='"+n.id+"' but has no next sibling element that it is associated with.")}else"oj-label-value"===a?v||e.refresh():e.classList.contains("oj-complete")?C(e):((l||t%m.maxColumns==0)&&e.setAttribute("data-oj-needs-oj-flex-div",""),d.push(e));t+=1,e=e.nextElementSibling}}(),function(){var e,t=[],l=s.children.length,a="column"===m.direction,o=0,i=0;!function(e,t){for(var l=t,a=e.length-1;a>=0;a--)l[a]=e[a]}(s.children,t);var r,u=m.maxColumns,c=0,f=!1,p=!1;for(;o<l;){var h=t[o];if(r=1,-1===d.indexOf(h)){var b=h.tagName.toLowerCase();if("oj-label"===b){var v=t[o+=1];e=S(h,v,a||i%u==0)}else if("labelHint"in h&&j(h))e=S(h,null,a||i%u==0);else{if("colspan"in h&&h.getAttribute("colspan"))if(a)f||(n.error('Colspan attribute is ignored unless direction is set to "row"'),f=!0);else{var y=u-c;r=Math.floor(h.colspan),"wrap"===m.colspanWrap&&y<r&&c>0?(W(e,i),i+=y,c=0,r=Math.min(r,u)):r=Math.min(r,y),!p&&u>1&&(p=!0)}e=S(h,null,a||i%u==0,r)}}c=(i+=r)%u,o+=1}p&&!a?s.classList.add("oj-form-control-full-width"):s.classList.remove("oj-form-control-full-width");W(e,i)}(),l&&(o=e.DomUtils.isAncestorOrSelf(m,l)),!v&&o&&setTimeout(function(){l.focus()},0),f._rootElementMutationObserver.observe(m,{childList:!0,subtree:!0,attributes:!0}),v&&(v=!1),x(),g()})}var o;y||(!(v||!m.hasAttribute("data-oj-context"))&&!(o=t.getContext(m).getBusyContext()).isReady()?(y=!0,o.whenReady().then(function(){y=!1,l()})):l())}}s.getDynamicDefaults=function(){return{labelEdge:(o.parseJSONFromFontFamily("oj-form-layout-option-defaults")||{}).labelEdge}},i.extension._CONSTRUCTOR=s,i.extension._TRACK_CHILDREN="nearestCustomElement",e.CustomElementBridge.register("oj-form-layout",{metadata:i})});