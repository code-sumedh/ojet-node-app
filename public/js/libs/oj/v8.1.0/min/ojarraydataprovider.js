/**
 * @license
 * Copyright (c) 2014, 2020, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 * @ignore
 */
"use strict";define(["ojs/ojcore","jquery","ojs/ojset","ojs/ojmap","ojs/ojdataprovider","ojs/ojeventtarget"],function(t,e,i,s,n){class r{constructor(t,e){this.data=t,this.options=e,this.Item=class{constructor(t,e,i){this._parent=t,this.metadata=e,this.data=i,this[r._METADATA]=e,this[r._DATA]=i}},this.ItemMetadata=class{constructor(t,e){this._parent=t,this.key=e,this[r._KEY]=e}},this.FetchByKeysResults=class{constructor(t,e,i){this._parent=t,this.fetchParameters=e,this.results=i,this[r._FETCHPARAMETERS]=e,this[r._RESULTS]=i}},this.ContainsKeysResults=class{constructor(t,e,i){this._parent=t,this.containsParameters=e,this.results=i,this[r._CONTAINSPARAMETERS]=e,this[r._RESULTS]=i}},this.FetchByOffsetResults=class{constructor(t,e,i,s){this._parent=t,this.fetchParameters=e,this.results=i,this.done=s,this[r._FETCHPARAMETERS]=e,this[r._RESULTS]=i,this[r._DONE]=s}},this.FetchListParameters=class{constructor(t,e,i,s,n){this._parent=t,this.size=e,this.sortCriteria=i,this.filterCriterion=s,this.attributes=n,this[r._SIZE]=e,this[r._SORTCRITERIA]=i,this[r._FILTERCRITERION]=s,this[r._ATTRIBUTES]=n}},this.FetchListResult=class{constructor(t,e,i,s){this._parent=t,this.fetchParameters=e,this.data=i,this.metadata=s,this[r._FETCHPARAMETERS]=e,this[r._DATA]=i,this[r._METADATA]=s}},this.AsyncIterable=class{constructor(t,e){this._parent=t,this._asyncIterator=e,this[Symbol.asyncIterator]=function(){return this._asyncIterator}}},this.AsyncIterator=class{constructor(t,e,i,s){this._parent=t,this._nextFunc=e,this._params=i,this._offset=s,this._cachedOffset=s,this._cacheObj={},this._cacheObj[r._MUTATIONSEQUENCENUM]=t._mutationSequenceNum}next(){let t=this._nextFunc(this._params,this._cachedOffset,this._cacheObj);return this._cachedOffset=t.offset,Promise.resolve(t.result)}},this.AsyncIteratorYieldResult=class{constructor(t,e){this._parent=t,this.value=e,this[r._VALUE]=e,this[r._DONE]=!1}},this.AsyncIteratorReturnResult=class{constructor(t,e){this._parent=t,this.value=e,this[r._VALUE]=e,this[r._DONE]=!0}},this.DataProviderMutationEventDetail=class{constructor(t,e,i,s){this._parent=t,this.add=e,this.remove=i,this.update=s,this[r._ADD]=e,this[r._REMOVE]=i,this[r._UPDATE]=s}},this.DataProviderOperationEventDetail=class{constructor(t,e,i,s,n){this._parent=t,this.keys=e,this.metadata=i,this.data=s,this.indexes=n,this[r._KEYS]=e,this[r._METADATA]=i,this[r._DATA]=s,this[r._INDEXES]=n}},this.DataProviderAddOperationEventDetail=class{constructor(t,e,i,s,n,a,l){this._parent=t,this.keys=e,this.afterKeys=i,this.addBeforeKeys=s,this.metadata=n,this.data=a,this.indexes=l,this[r._KEYS]=e,this[r._AFTERKEYS]=i,this[r._ADDBEFOREKEYS]=s,this[r._METADATA]=n,this[r._DATA]=a,this[r._INDEXES]=l}},this._cachedIndexMap=[],this._sequenceNum=0,this._mutationSequenceNum=0,this._subscribeObservableArray(t),null!=e&&null!=e[r._KEYS]&&(this._keysSpecified=!0,this._keys=e[r._KEYS])}containsKeys(t){let e=this;return this.fetchByKeys(t).then(function(s){let n=new i;return t[r._KEYS].forEach(function(t){null!=s[r._RESULTS].get(t)&&n.add(t)}),Promise.resolve(new e.ContainsKeysResults(e,t,n))})}fetchByKeys(e){let i=this;this._generateKeysIfNeeded();let n,a=new s,l=this._getKeys(),u=null!=e?e[r._ATTRIBUTES]:null,o=0;if(e){let s=i._getRowData();return e[r._KEYS].forEach(function(e){for(n=null,o=0;o<l.length;o++)if(t.Object.compareValues(l[o],e)){n=o;break}if(null!=n&&n>=0){let t=s[n];if(u&&u.length>0){let e={};i._filterRowAttributes(u,t,e),t=e}a.set(e,new i.Item(i,new i.ItemMetadata(i,e),t))}}),Promise.resolve(new i.FetchByKeysResults(i,e,a))}return Promise.reject("Keys are a required parameter")}fetchByOffset(t){let e=this,i=null!=t?t[r._SIZE]:-1,s=null!=t?t[r._SORTCRITERIA]:null,n=null!=t&&t[r._OFFSET]>0?t[r._OFFSET]:0,a=null!=t?t[r._ATTRIBUTES]:null,l=null!=t?t[r._FILTERCRITERION]:null;this._generateKeysIfNeeded();let u=[],o=!0;if(t){let h=new this.FetchListParameters(this,i,s,l,a),_=this._fetchFrom(h,n).result,c=_[r._VALUE];o=_[r._DONE];let f=c[r._DATA],E=c[r._METADATA].map(function(t){return t[r._KEY]});return u=f.map(function(t,i){return new e.Item(e,new e.ItemMetadata(e,E[i]),t)}),Promise.resolve(new this.FetchByOffsetResults(this,t,u,o))}return Promise.reject("Offset is a required parameter")}fetchFirst(t){return new this.AsyncIterable(this,new this.AsyncIterator(this,this._fetchFrom.bind(this),t,0))}getCapability(t){return r.getCapability(t)}static getCapability(t){if("sort"==t)return{attributes:"multiple"};if("fetchByKeys"==t)return{implementation:"lookup"};if("fetchByOffset"==t)return{implementation:"randomAccess"};if("fetchCapability"==t){let t=new Set;return t.add("exclusion"),{attributeFilter:{expansion:{},ordering:{},defaultShape:{features:t}}}}return"filter"==t?{operators:["$co","$eq","$ew","$pr","$gt","$ge","$lt","$le","$ne","$regex","$sw"],attributeExpression:["*"],textFilter:{}}:null}getTotalSize(){return Promise.resolve(this._getRowData().length)}isEmpty(){return this._getRowData().length>0?"no":"yes"}createOptimizedKeySet(t){return new i(t)}createOptimizedKeyMap(t){if(t){let e=new s;return t.forEach(function(t,i){e.set(i,t)}),e}return new s}_getRowData(){return this[r._DATA]instanceof Array?this[r._DATA]:this[r._DATA]()}_getKeys(){return null==this._keys||this._keys instanceof Array?this._keys:this._keys()}_indexOfKey(e){let i,s=this._getKeys(),n=-1;for(i=0;i<s.length;i++)if(t.Object.compareValues(s[i],e)){n=i;break}return n}_subscribeObservableArray(e){if(!(e instanceof Array)){if(!this._isObservableArray(e))throw new Error("Invalid data type. ArrayDataProvider only supports Array or observableArray.");let s=this;e.subscribe(function(e){let n,r,a,l,u,o=[],h=[],_=[],c=[],f=[];s._mutationSequenceNum++;let E=!0,d=!0;e.forEach(function(t){"deleted"===t.status?E=!1:"added"===t.status&&(d=!1)});let A=[],T=[],p=null,m=null,R=null,y=s._generateKeysIfNeeded();if(!E&&!d){for(n=0;n<e.length;n++){l=e[n].index,u=e[n].status;let i=s._getId(e[n].value);for(r=0;r<e.length;r++)r!=n&&l===e[r].index&&u!==e[r].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(null==i||t.Object.compareValues(i,s._getId(e[r].value)))&&("deleted"===u?(T.push(n),A.push(r)):(T.push(r),A.push(n)))}for(n=0;n<e.length;n++)if(A.indexOf(n)>=0){let t=s._getKeys()[e[n].index];h.push(t),o.push(e[n].value),_.push(e[n].index)}if(h.length>0){c=h.map(function(t){return new s.ItemMetadata(s,t)});let t=new i;h.map(function(e){t.add(e)}),p=new s.DataProviderOperationEventDetail(s,t,c,o,_)}}if(o=[],h=[],_=[],!E){for(n=0;n<e.length;n++)"deleted"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(h.push(s._getKeys()[e[n].index]),o.push(e[n].value),_.push(e[n].index));if(h.length>0&&h.map(function(t){let e=s._indexOfKey(t);s._keys.splice(e,1)}),h.length>0){c=h.map(function(t){return new s.ItemMetadata(s,t)});let t=new i;h.map(function(e){t.add(e)}),R=new s.DataProviderOperationEventDetail(s,t,c,o,_)}}if(o=[],h=[],_=[],!d){let t=null==s._getKeys()||!(s._getKeys().length>0);for(n=0;n<e.length;n++)"added"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0&&(null==(a=s._getId(e[n].value))&&(y||s._keysSpecified)&&(a=s._getKeys()[e[n].index]),null==a?(a=s._sequenceNum++,s._keys.splice(e[n].index,0,a)):(t||-1===s._indexOfKey(a))&&s._keys.splice(e[n].index,0,a),h.push(a),o.push(e[n].value),_.push(e[n].index));for(n=0;n<e.length;n++)if("added"===e[n].status&&A.indexOf(n)<0&&T.indexOf(n)<0){let t=s._getKeys()[e[n].index+1];t=null==t?null:t,f.push(t)}if(h.length>0){c=h.map(function(t){return new s.ItemMetadata(s,t)});let t=new i;h.map(function(e){t.add(e)});let e=new i;f.map(function(t){e.add(t)}),m=new s.DataProviderAddOperationEventDetail(s,t,e,f,c,o,_)}}s._fireMutationEvent(m,R,p)},null,"arrayChange"),e.subscribe(function(e){s._mutationEvent?s.dispatchEvent(s._mutationEvent):s._mutationRemoveEvent||s._mutationAddEvent||s._mutationUpdateEvent?(s._mutationRemoveEvent&&s.dispatchEvent(s._mutationRemoveEvent),s._mutationAddEvent&&s.dispatchEvent(s._mutationAddEvent),s._mutationUpdateEvent&&s.dispatchEvent(s._mutationUpdateEvent)):s.dispatchEvent(new t.DataProviderRefreshEvent),s._mutationEvent=null,s._mutationRemoveEvent=null,s._mutationAddEvent=null,s._mutationUpdateEvent=null},null,"change")}}_fireMutationEvent(e,i,s){let n=this,r=!1;if(["keys","indexes"].forEach(function(t){r||(r=n._hasSamePropValue(i,e,t)||n._hasSamePropValue(i,s,t)||n._hasSamePropValue(e,s,t))}),r){if(i){let e=new this.DataProviderMutationEventDetail(this,null,i,null);this._mutationRemoveEvent=new t.DataProviderMutationEvent(e)}if(e){let i=new this.DataProviderMutationEventDetail(this,e,null,null);this._mutationAddEvent=new t.DataProviderMutationEvent(i)}if(s){let e=new this.DataProviderMutationEventDetail(this,null,null,s);this._mutationUpdateEvent=new t.DataProviderMutationEvent(e)}}else{let n=new this.DataProviderMutationEventDetail(this,e,i,s);this._mutationEvent=new t.DataProviderMutationEvent(n)}}_hasSamePropValue(e,i,s){let n=!1;return e&&e[s]&&e[s].forEach(function(e){!n&&i&&i[s]&&i[s].forEach(function(i){!n&&t.Object.compareValues(e,i)&&(n=!0)})}),n}_isObservableArray(t){return"function"==typeof t&&t.subscribe&&!(void 0===t.destroyAll)}_generateKeysIfNeeded(){if(null==this._keys){let t=null!=this.options?this.options[r._KEYATTRIBUTES]||this.options[r._IDATTRIBUTE]:null;this._keys=[];let e,i=this._getRowData(),s=0;for(s=0;s<i.length;s++)null!=(e=this._getId(i[s]))&&"@index"!=t||(e=this._sequenceNum++),this._keys[s]=e;return!0}return!1}_getId(t){let e,i=null!=this.options?this.options[r._KEYATTRIBUTES]||this.options[r._IDATTRIBUTE]:null;if(null!=i){if(Array.isArray(i)){let s;for(e=[],s=0;s<i.length;s++)e[s]=this._getVal(t,i[s])}else e="@value"==i?this._getAllVals(t):this._getVal(t,i);return e}return null}_getVal(t,e){return"function"==typeof t[e]?t[e]():t[e]}_getAllVals(t){let e=this;return Object.keys(t).map(function(i){return e._getVal(t,i)})}_fetchFrom(t,e,i){let s=this,a=null!=t?t[r._ATTRIBUTES]:null;this._generateKeysIfNeeded();let l=null!=t?t[r._SORTCRITERIA]:null,u=this._getCachedIndexMap(l,i),o=this._getRowData(),h=u.map(function(t){return o[t]}),_=u.map(function(t){return s._getKeys()[t]}),c=null!=t?t[r._SIZE]>0?t[r._SIZE]:t[r._SIZE]<0?s._getKeys().length:25:25,f=e+c<h.length,E=this._mergeSortCriteria(l);null!=E&&((t=t||{})[r._SORTCRITERIA]=E);let d,A=[],T=[],p=0;if(null!=t&&t[r._FILTERCRITERION]){let i=null;i=t[r._FILTERCRITERION].filter?t[r._FILTERCRITERION]:n.FilterFactory.getFilter({filterDef:t[r._FILTERCRITERION],filterOptions:this.options});let s=0;for(;A.length<c&&s<h.length;)i.filter(h[s])&&(p>=e&&(A.push(h[s]),T.push(_[s])),p++),s++;f=s<h.length}else A=h.slice(e,e+c),T=_.slice(e,e+c);p=e+A.length,d=A.map(function(t){if(a&&a.length>0){let e={};s._filterRowAttributes(a,t,e),t=e}return t});let m=T.map(function(t){return new s.ItemMetadata(s,t)}),R=new this.FetchListResult(this,t,d,m);return f?{result:new this.AsyncIteratorYieldResult(this,R),offset:p}:{result:new this.AsyncIteratorReturnResult(this,R),offset:p}}_getCachedIndexMap(t,e){if(e&&e.indexMap&&e[r._MUTATIONSEQUENCENUM]===this._mutationSequenceNum)return e.indexMap;let i=this._getRowData().map(function(t,e){return e}),s=this._sortData(i,t);return e&&(e.indexMap=s,e[r._MUTATIONSEQUENCENUM]=this._mutationSequenceNum),s}_sortData(t,e){let i=this._getRowData(),s=t.map(function(t){return{index:t,value:i[t]}});return null!=e&&s.sort(this._getSortComparator(e)),s.map(function(t){return t.index})}_getSortComparator(t){let e=this;return function(i,s){let n,a,l,u,o,h,_=null!=e.options?e.options[r._SORTCOMPARATORS]:null;for(n=0;n<t.length;n++)if(a=t[n][r._DIRECTION],l=t[n][r._ATTRIBUTE],u=null,null!=_&&(u=_[r._COMPARATORS].get(l)),o=e._getVal(i.value,l),h=e._getVal(s.value,l),null!=u){let t="descending"==a?-1:1,e=u(o,h)*t;if(0!=e)return e}else{let t=0,e="string"==typeof o?o:new String(o).toString(),i="string"==typeof h?h:new String(h).toString();if(0!=(t="ascending"==a?e.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"}):i.localeCompare(e,void 0,{numeric:!0,sensitivity:"base"})))return t}return 0}}_mergeSortCriteria(t){let e=null!=this.options?this.options[r._IMPLICITSORT]:null;if(null!=e){if(null==t)return e;let i,s,n,a=t.slice(0);for(i=0;i<e.length;i++){for(n=!1,s=0;s<a.length;s++)a[s][r._ATTRIBUTE]==e[i][r._ATTRIBUTE]&&(n=!0);n||a.push(e[i])}return a}return t}_filterRowAttributes(t,e,i){let s=this;if(Array.isArray(t)){let n,a=!1;t.forEach(function(t){t!=r._ATDEFAULT&&t.name!=r._ATDEFAULT||(a=!0)}),Object.keys(e).forEach(function(r){if(a){let a,l=!1,u=r;for(n=0;n<t.length;n++)if((a=t[n]instanceof Object?t[n].name:t[n]).startsWith("!")){if((a=a.substr(1,a.length-1))==r){l=!0;break}}else if(a==r){u=t[n];break}l||s._filterRowAttributes(u,e,i)}else t.forEach(function(t){let n;(n=t instanceof Object?t.name:t).startsWith("!")||n!=r||s._filterRowAttributes(t,e,i)})})}else if(t instanceof Object){let n=t.name,r=t.attributes;if(n&&!n.startsWith("!"))if(e[n]instanceof Object&&!Array.isArray(e[n])&&r){let t={};s._filterRowAttributes(r,e[n],t),i[n]=t}else if(Array.isArray(e[n])&&r){let t;i[n]=[],e[n].forEach(function(e,a){t={},s._filterRowAttributes(r,e,t),i[n][a]=t})}else s._proxyAttribute(i,e,n)}else s._proxyAttribute(i,e,t)}_proxyAttribute(t,e,i){t&&e&&Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){e[i]=t},enumerable:!0})}}
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
/**
 * @preserve Copyright 2013 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
return r._KEY="key",r._KEYS="keys",r._AFTERKEYS="afterKeys",r._ADDBEFOREKEYS="addBeforeKeys",r._DIRECTION="direction",r._ATTRIBUTE="attribute",r._ATTRIBUTES="attributes",r._SORT="sort",r._SORTCRITERIA="sortCriteria",r._FILTERCRITERION="filterCriterion",r._DATA="data",r._METADATA="metadata",r._INDEXES="indexes",r._OFFSET="offset",r._SIZE="size",r._IDATTRIBUTE="idAttribute",r._IMPLICITSORT="implicitSort",r._KEYATTRIBUTES="keyAttributes",r._SORTCOMPARATORS="sortComparators",r._COMPARATORS="comparators",r._COMPARATOR="comparator",r._RESULTS="results",r._CONTAINS="contains",r._FETCHPARAMETERS="fetchParameters",r._CONTAINSPARAMETERS="containsParameters",r._VALUE="value",r._DONE="done",r._ADD="add",r._REMOVE="remove",r._UPDATE="update",r._DETAIL="detail",r._FETCHLISTRESULT="fetchListResult",r._ATDEFAULT="@default",r._MUTATIONSEQUENCENUM="mutationSequenceNum",t.ArrayDataProvider=r,t.EventTargetMixin.applyMixin(r),r});